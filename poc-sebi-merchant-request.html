<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POC - SEBI Merchant Instrument Request (OC217)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f5f7fa;
            padding: 24px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 20px 24px;
            border-radius: 12px 12px 0 0;
            border-bottom: 2px solid #e2e8f0;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .header-title h1 {
            font-size: 24px;
            color: #2d3748;
            font-weight: 600;
        }

        .header-subtitle {
            font-size: 14px;
            color: #718096;
        }

        .template-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: #eef2ff;
            color: #4c51bf;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            border: 2px solid #c7d2fe;
        }

        .info-banner {
            background: #fffbeb;
            border: 2px solid #fbbf24;
            border-radius: 8px;
            padding: 16px;
            margin: 20px 24px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .info-banner-icon {
            font-size: 20px;
            flex-shrink: 0;
        }

        .info-banner-content {
            flex: 1;
        }

        .info-banner-content h3 {
            color: #78350f;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .info-banner-content p {
            color: #92400e;
            font-size: 13px;
            line-height: 1.5;
        }

        .form-container {
            background: white;
            border-radius: 0 0 12px 12px;
            padding: 32px 24px;
        }

        .section {
            margin-bottom: 32px;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #e2e8f0;
        }

        .section-icon {
            font-size: 20px;
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
            color: #2d3748;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-label {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #2d3748;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .required {
            color: #e53e3e;
        }

        .info-icon {
            cursor: help;
            color: #718096;
            font-size: 16px;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-input:disabled {
            background: #f7fafc;
            cursor: not-allowed;
        }

        .form-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .form-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-select:disabled {
            background: #f7fafc;
            cursor: not-allowed;
        }

        .helper-text {
            color: #718096;
            font-size: 13px;
            margin-top: 6px;
        }

        .error-text {
            color: #e53e3e;
            font-size: 13px;
            margin-top: 6px;
            display: none;
        }

        .success-text {
            color: #22543d;
            font-size: 13px;
            margin-top: 6px;
            display: none;
        }

        .form-group.error .form-input,
        .form-group.error .form-select {
            border-color: #e53e3e;
        }

        .form-group.error .error-text {
            display: block;
        }

        .form-group.success .form-input {
            border-color: #48bb78;
        }

        .form-group.success .success-text {
            display: block;
        }

        .merchant-info-card {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            margin-top: 12px;
            display: none;
        }

        .merchant-info-card.active {
            display: block;
        }

        .merchant-info-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .merchant-info-row:last-child {
            border-bottom: none;
        }

        .merchant-info-label {
            color: #718096;
            font-size: 13px;
            font-weight: 500;
        }

        .merchant-info-value {
            color: #2d3748;
            font-size: 13px;
            font-weight: 600;
        }

        .mcc-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
        }

        .mcc-badge.sebi {
            background: #d1fae5;
            color: #065f46;
        }

        .bank-selection {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .bank-option {
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }

        .bank-option:hover {
            border-color: #667eea;
            background: #f7fafc;
        }

        .bank-option.selected {
            border-color: #667eea;
            background: #eef2ff;
        }

        .bank-option input[type="radio"] {
            display: none;
        }

        .bank-logo {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .bank-name {
            font-weight: 600;
            color: #2d3748;
            font-size: 14px;
        }

        .sebi-fields-container {
            background: #f0fdf4;
            border: 2px solid #86efac;
            border-radius: 8px;
            padding: 20px;
            margin-top: 16px;
        }

        .sebi-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 16px;
        }

        .sebi-header-icon {
            font-size: 24px;
        }

        .sebi-header-text h3 {
            color: #166534;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .sebi-header-text p {
            color: #15803d;
            font-size: 13px;
        }

        .file-upload {
            border: 2px dashed #cbd5e0;
            border-radius: 8px;
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .file-upload:hover {
            border-color: #667eea;
            background: #f7fafc;
        }

        .file-upload.has-file {
            border-color: #48bb78;
            background: #f0fdf4;
        }

        .file-upload-icon {
            font-size: 32px;
            margin-bottom: 8px;
            color: #718096;
        }

        .file-upload-text {
            color: #4a5568;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .file-upload-subtext {
            color: #718096;
            font-size: 12px;
        }

        .file-input {
            display: none;
        }

        .verification-status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            margin-top: 8px;
        }

        .verification-status.pending {
            background: #fef3c7;
            color: #92400e;
        }

        .verification-status.verified {
            background: #d1fae5;
            color: #065f46;
        }

        .verification-status.failed {
            background: #fee2e2;
            color: #991b1b;
        }

        .action-buttons {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            padding-top: 24px;
            border-top: 2px solid #e2e8f0;
        }

        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }

        .btn-secondary {
            background: #f7fafc;
            color: #4a5568;
            border: 2px solid #e2e8f0;
        }

        .btn-secondary:hover {
            background: #e2e8f0;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            transform: none;
        }

        .auto-detect-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            background: #e0e7ff;
            color: #4c51bf;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
        }

        /* Modal styles from original */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: 16px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 32px 32px 24px;
            border-bottom: 1px solid #e2e8f0;
        }

        .modal-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .modal-title {
            font-size: 24px;
            color: #2d3748;
            margin-bottom: 12px;
            font-weight: 600;
        }

        .modal-description {
            color: #718096;
            line-height: 1.6;
            font-size: 15px;
        }

        .modal-body {
            padding: 32px;
        }

        .steps-list {
            list-style: none;
            margin-bottom: 24px;
        }

        .steps-list li {
            padding: 16px;
            background: #f7fafc;
            border-radius: 8px;
            margin-bottom: 12px;
            color: #4a5568;
            font-size: 15px;
            line-height: 1.5;
        }

        .steps-list li strong {
            color: #2d3748;
            display: block;
            margin-bottom: 4px;
        }

        .portal-link {
            display: inline-flex;
            align-items: center;
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            padding: 10px 16px;
            background: #eef2ff;
            border-radius: 6px;
            transition: all 0.2s ease;
            margin-top: 8px;
        }

        .portal-link:hover {
            background: #e0e7ff;
        }

        .checkbox-container {
            display: flex;
            align-items: center;
            padding: 16px;
            background: #f0fdf4;
            border: 2px solid #86efac;
            border-radius: 8px;
            margin-top: 24px;
            cursor: pointer;
        }

        .checkbox-container input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            cursor: pointer;
        }

        .checkbox-container label {
            color: #166534;
            font-weight: 500;
            cursor: pointer;
        }

        .modal-footer {
            padding: 24px 32px;
            border-top: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            gap: 12px;
        }

        .progress-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 32px;
        }

        .progress-step {
            flex: 1;
            text-align: center;
            position: relative;
            padding-bottom: 8px;
        }

        .progress-step::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: #e2e8f0;
            border-radius: 2px;
        }

        .progress-step.active::before {
            background: #667eea;
        }

        .progress-step.completed::before {
            background: #48bb78;
        }

        .progress-label {
            font-size: 12px;
            color: #a0aec0;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 8px;
        }

        .progress-step.active .progress-label {
            color: #667eea;
        }

        .progress-step.completed .progress-label {
            color: #48bb78;
        }

        .success-message {
            text-align: center;
            padding: 40px;
        }

        .success-icon {
            font-size: 64px;
            margin-bottom: 24px;
        }

        .success-title {
            font-size: 24px;
            color: #2d3748;
            margin-bottom: 12px;
            font-weight: 600;
        }

        .success-description {
            color: #718096;
            line-height: 1.6;
            margin-bottom: 24px;
        }

        .checkbox-option {
            display: flex;
            align-items: center;
            margin-bottom: 16px;
        }

        .checkbox-option input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin-right: 10px;
            cursor: pointer;
        }

        .checkbox-option label {
            margin: 0;
            cursor: pointer;
            font-weight: 500;
            color: #2d3748;
            font-size: 14px;
        }

        .info-note {
            background: #fffbeb;
            border: 1px solid #fbbf24;
            border-radius: 6px;
            padding: 12px;
        }

        .info-note p {
            color: #78350f;
            font-size: 13px;
            line-height: 1.5;
            margin: 0;
        }

        .advanced-options-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 8px;
        }

        .advanced-options-header:hover {
            background: #edf2f7;
        }

        .advanced-options-label {
            font-weight: 600;
            color: #2d3748;
            font-size: 14px;
        }

        .chevron {
            color: #718096;
            font-size: 12px;
            transition: transform 0.3s;
        }

        .chevron.rotated {
            transform: rotate(-180deg);
        }

        .advanced-options-content {
            margin-top: 12px;
            padding: 16px;
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
        }

        .advanced-settlement-info {
            margin-bottom: 16px;
            padding: 12px;
            background: white;
            border-radius: 6px;
        }

        .advanced-settlement-info p {
            margin-bottom: 8px;
            color: #2d3748;
            font-size: 13px;
        }

        .advanced-settlement-info ul {
            margin-left: 20px;
            color: #4a5568;
            font-size: 13px;
        }

        .advanced-settlement-info li {
            margin-bottom: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <div class="header-title">
                    <h1>New Instrument Request</h1>
                    <p class="header-subtitle">Raise request on behalf of SEBI-regulated merchant</p>
                </div>
                <div class="template-badge">
                    üîí OC217 Template
                </div>
            </div>
        </div>

        <!-- Info Banner -->
        <div class="info-banner">
            <div class="info-banner-icon">üí°</div>
            <div class="info-banner-content">
                <h3>About OC217 Template</h3>
                <p>This template is specifically designed for SEBI-regulated merchants (MCC 6211). It automatically applies appropriate terminal configurations and compliance requirements as per SEBI circular SEBI/HO/DEPA-II/DEPA-II_SRG/P/CIR/2025/86.</p>
            </div>
        </div>

        <!-- Form -->
        <div class="form-container">
            <!-- Section 1: Merchant Details -->
            <div class="section">
                <div class="section-header">
                    <span class="section-icon">üë§</span>
                    <h2 class="section-title">Merchant Details</h2>
                </div>

                <div class="form-grid">
                    <div class="form-group full-width">
                        <label class="form-label">
                            Merchant ID <span class="required">*</span>
                            <span class="info-icon" title="Enter the merchant's unique identifier">‚ìò</span>
                        </label>
                        <input
                            type="text"
                            class="form-input"
                            id="merchantId"
                            placeholder="e.g., wedvfs dfbvds"
                            oninput="validateMerchantId()"
                        />
                        <p class="helper-text">Requests can be raised for one merchant at a time</p>
                        <p class="error-text" id="merchantIdError">Please enter a valid merchant ID</p>
                    </div>
                </div>

                <!-- Merchant Info Card (appears after validation) -->
                <div class="merchant-info-card" id="merchantInfoCard">
                    <div class="merchant-info-row">
                        <span class="merchant-info-label">Merchant Name</span>
                        <span class="merchant-info-value" id="merchantName">-</span>
                    </div>
                    <div class="merchant-info-row">
                        <span class="merchant-info-label">MCC Category</span>
                        <span class="merchant-info-value">
                            <span class="mcc-badge sebi">
                                ‚úì 6211 - SEBI Regulated
                            </span>
                            <span class="auto-detect-badge">üîç Auto-detected</span>
                        </span>
                    </div>
                    <div class="merchant-info-row">
                        <span class="merchant-info-label">Business Type</span>
                        <span class="merchant-info-value" id="businessType">-</span>
                    </div>
                </div>
            </div>

            <!-- Section 2: Payment Configuration -->
            <div class="section">
                <div class="section-header">
                    <span class="section-icon">üí≥</span>
                    <h2 class="section-title">Payment Configuration</h2>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">
                            Payment Method <span class="required">*</span>
                        </label>
                        <select class="form-select" id="paymentMethod" disabled>
                            <option value="upi" selected>UPI (Auto-selected for OC217)</option>
                        </select>
                        <p class="helper-text">Fixed for SEBI merchants as per OC217</p>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            Feature <span class="required">*</span>
                        </label>
                        <select class="form-select" id="feature" onchange="validateForm()">
                            <option value="">Select feature</option>
                            <option value="DS">DS (Direct Settlement)</option>
                            <option value="standard">Standard Settlement</option>
                        </select>
                    </div>

                    <div class="form-group full-width">
                        <label class="form-label">
                            Refund Configuration <span class="required">*</span>
                        </label>
                        <select class="form-select" id="refund" onchange="validateForm()">
                            <option value="">Select refund option</option>
                            <option value="without_refund">Without Refund</option>
                            <option value="with_refund">With Refund</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Section 3: Bank Selection (Restricted) -->
            <div class="section">
                <div class="section-header">
                    <span class="section-icon">üè¶</span>
                    <h2 class="section-title">Bank Selection</h2>
                    <span class="auto-detect-badge">üîí Restricted to OC217 approved banks</span>
                </div>

                <div class="bank-selection">
                    <label class="bank-option" onclick="selectBank('axis')">
                        <input type="radio" name="bank" value="axis" id="bankAxis">
                        <div class="bank-logo">üÖ∞Ô∏è</div>
                        <div class="bank-name">Axis Bank</div>
                    </label>

                    <label class="bank-option" onclick="selectBank('hdfc')">
                        <input type="radio" name="bank" value="hdfc" id="bankHdfc">
                        <div class="bank-logo">üè¶</div>
                        <div class="bank-name">HDFC Bank</div>
                    </label>

                    <label class="bank-option" onclick="selectBank('icici')">
                        <input type="radio" name="bank" value="icici" id="bankIcici">
                        <div class="bank-logo">üèõÔ∏è</div>
                        <div class="bank-name">ICICI Bank</div>
                    </label>
                </div>
                <p class="helper-text" style="margin-top: 12px;">Only Axis, HDFC, and ICICI banks are approved for SEBI-regulated merchant terminals</p>
            </div>

            <!-- Section 4: SEBI-Specific Information -->
            <div class="section">
                <div class="section-header">
                    <span class="section-icon">üõ°Ô∏è</span>
                    <h2 class="section-title">SEBI Compliance Information</h2>
                </div>

                <div class="sebi-fields-container">
                    <div class="sebi-header">
                        <div class="sebi-header-icon">üìã</div>
                        <div class="sebi-header-text">
                            <h3>SEBI Validated UPI Details</h3>
                            <p>Required as per SEBI circular for payment collection</p>
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group full-width">
                            <label class="form-label">
                                SEBI Registration Number <span class="required">*</span>
                            </label>
                            <input
                                type="text"
                                class="form-input"
                                id="sebiRegistration"
                                placeholder="e.g., INZ000012345"
                                oninput="validateForm()"
                            />
                            <p class="helper-text">Enter the merchant's SEBI registration number</p>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                VPA (Validated UPI ID) <span class="required">*</span>
                                <button class="btn-secondary" style="margin-left: auto; padding: 6px 12px; font-size: 12px;" onclick="openVpaVerificationModal()">
                                    Generate VPA
                                </button>
                            </label>
                            <input
                                type="text"
                                class="form-input"
                                id="vpa"
                                placeholder="merchant.name@validhdfc"
                                oninput="validateVPA()"
                            />
                            <p class="helper-text">Must use @valid handle (e.g., @validhdfc, @validaxis, @validicici)</p>
                            <p class="error-text" id="vpaError">VPA must use validated @valid handle</p>
                            <p class="success-text" id="vpaSuccess">‚úì Valid SEBI UPI ID format</p>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                VPA Verification Status
                            </label>
                            <div class="verification-status pending" id="vpaStatus">
                                ‚è≥ Pending Verification
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Settlement Account Number <span class="required">*</span>
                            </label>
                            <input
                                type="text"
                                class="form-input"
                                id="settlementAccount"
                                placeholder="50100123456789"
                                oninput="validateForm()"
                            />
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                IFSC Code <span class="required">*</span>
                            </label>
                            <input
                                type="text"
                                class="form-input"
                                id="ifsc"
                                placeholder="HDFC0001234"
                                maxlength="11"
                                oninput="validateIFSC()"
                            />
                            <p class="helper-text">11-character IFSC code</p>
                        </div>

                        <div class="form-group full-width" id="iciciMidGroup" style="display: none;">
                            <label class="form-label">
                                ICICI MID <span class="required">*</span>
                            </label>
                            <input
                                type="text"
                                class="form-input"
                                id="iciciMid"
                                placeholder="ICICI12345"
                                oninput="validateForm()"
                            />
                            <p class="helper-text">Required for @validicici VPA handles</p>
                        </div>
                    </div>

                    <!-- SEBI Document Upload -->
                    <div class="form-group" style="margin-top: 24px;">
                        <label class="form-label">
                            SEBI Certificate / Proof of Validation <span class="required">*</span>
                        </label>
                        <div class="file-upload" id="fileUploadArea" onclick="document.getElementById('fileInput').click()">
                            <div class="file-upload-icon">üìÑ</div>
                            <div class="file-upload-text">Click to upload or drag and drop</div>
                            <div class="file-upload-subtext">PDF, JPG, PNG (Max 5MB)</div>
                        </div>
                        <input type="file" id="fileInput" class="file-input" accept=".pdf,.jpg,.jpeg,.png" onchange="handleFileUpload()">
                        <p class="helper-text" id="fileName" style="display: none; margin-top: 8px;"></p>
                    </div>

                    <!-- Advanced Options -->
                    <div class="form-group" style="margin-top: 24px;">
                        <div class="advanced-options-header" onclick="toggleAdvancedOptions()">
                            <span class="advanced-options-label">Advanced Settlement Options</span>
                            <span class="chevron" id="advancedChevron">‚ñº</span>
                        </div>
                        <div class="advanced-options-content" id="advancedOptionsContent" style="display: none;">
                            <div class="checkbox-option">
                                <input type="checkbox" id="directSettlementCheckbox">
                                <label for="directSettlementCheckbox">Request for direct settlement terminals</label>
                            </div>
                            <div class="advanced-settlement-info">
                                <p><strong>Available options:</strong></p>
                                <ul>
                                    <li>Merchant Direct (Mx-DS)</li>
                                    <li>BSE Direct Settlement</li>
                                    <li>NSE Direct Settlement</li>
                                </ul>
                            </div>
                            <div class="info-note">
                                <p>üí° Direct settlement terminals may require additional verification and could result in 3-4 days delay in method enablement.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section 5: Additional Information -->
            <div class="section">
                <div class="section-header">
                    <span class="section-icon">üè∑Ô∏è</span>
                    <h2 class="section-title">Additional Information</h2>
                </div>

                <div class="form-grid">
                    <div class="form-group full-width">
                        <label class="form-label">
                            Tags
                        </label>
                        <input
                            type="text"
                            class="form-input"
                            id="tags"
                            placeholder="comma separated tag values"
                        />
                        <p class="helper-text">Add comma-separated tags for tracking and organization</p>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            Special Pricing
                        </label>
                        <div class="checkbox-option">
                            <input type="checkbox" id="specialPricing">
                            <label for="specialPricing">Apply special pricing for this merchant</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="btn btn-secondary" onclick="resetForm()">Cancel</button>
                <button class="btn btn-primary" id="submitBtn" disabled onclick="submitRequest()">
                    Submit Request
                </button>
            </div>
        </div>
    </div>

    <!-- VPA Verification Modal -->
    <div class="modal-overlay" id="vpaModalOverlay">
        <div class="modal">
            <!-- Screen 1: SEBI Compliance Notice -->
            <div id="vpaScreen1" class="screen">
                <div class="modal-header">
                    <div class="modal-icon">‚ö†Ô∏è</div>
                    <h2 class="modal-title">SEBI Regulatory Requirement</h2>
                    <p class="modal-description">
                        As a SEBI-regulated intermediary, the merchant must obtain a validated UPI ID from
                        SEBI portal before enabling UPI payments.
                    </p>
                </div>
                <div class="modal-body">
                    <div style="background: #eef2ff; padding: 20px; border-radius: 8px; border-left: 4px solid #667eea;">
                        <p style="color: #3730a3; margin-bottom: 12px; font-weight: 600;">Why is this required?</p>
                        <p style="color: #4c51bf; font-size: 14px; line-height: 1.6; margin: 0;">
                            SEBI circular (SEBI/HO/DEPA-II/DEPA-II_SRG/P/CIR/2025/86) mandates that
                            all regulated intermediaries must use validated UPI IDs with @valid handles
                            for payment collection to ensure compliance and security.
                        </p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeVpaModal()">Cancel</button>
                    <button class="btn btn-primary" onclick="goToVpaScreen(2)">Proceed to Instructions ‚Üí</button>
                </div>
            </div>

            <!-- Screen 2: SEBI Portal Instructions -->
            <div id="vpaScreen2" class="screen" style="display: none;">
                <div class="progress-bar">
                    <div class="progress-step completed">
                        <div class="progress-label">Notice</div>
                    </div>
                    <div class="progress-step active">
                        <div class="progress-label">Instructions</div>
                    </div>
                    <div class="progress-step">
                        <div class="progress-label">Complete</div>
                    </div>
                </div>

                <div class="modal-header">
                    <div class="modal-icon">üìù</div>
                    <h2 class="modal-title">Steps to Generate Validated UPI ID</h2>
                    <p class="modal-description">
                        Guide the merchant to follow these steps on the SEBI SI Portal
                    </p>
                </div>
                <div class="modal-body">
                    <ul class="steps-list">
                        <li>
                            <strong>1. Visit SEBI SI Portal</strong>
                            <a href="https://si.sebi.gov.in" target="_blank" class="portal-link">
                                Open Portal ‚Üó
                            </a>
                        </li>
                        <li>
                            <strong>2. Login with SEBI credentials</strong>
                            Merchant should use their registered SEBI intermediary login credentials
                        </li>
                        <li>
                            <strong>3. Navigate to "UPI ID Generation"</strong>
                            Find the UPI ID Generation section in the dashboard
                        </li>
                        <li>
                            <strong>4. Generate @valid UPI ID</strong>
                            Follow the portal's instructions to create validated UPI ID
                        </li>
                        <li>
                            <strong>5. Share VPA with POC</strong>
                            Merchant should provide the generated VPA back to you
                        </li>
                    </ul>

                    <div class="checkbox-container" onclick="toggleVpaCheckbox()">
                        <input type="checkbox" id="vpaCompletionCheckbox" onchange="updateVpaProceedButton()">
                        <label for="vpaCompletionCheckbox">Merchant has completed these steps and provided VPA</label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="goToVpaScreen(1)">‚Üê Back</button>
                    <button class="btn btn-primary" id="vpaCompleteBtn" disabled onclick="completeVpaVerification()">
                        Complete ‚Üí
                    </button>
                </div>
            </div>

            <!-- Success Screen -->
            <div id="vpaSuccessScreen" class="screen" style="display: none;">
                <div class="modal-body">
                    <div class="success-message">
                        <div class="success-icon">‚úÖ</div>
                        <h2 class="success-title">Instructions Shared!</h2>
                        <p class="success-description">
                            Please ensure the merchant follows the steps to generate their validated UPI ID
                            and shares it with you to complete this form.
                        </p>
                        <button class="btn btn-primary" onclick="closeVpaModal()">Done</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let merchantData = null;
        let selectedBank = null;
        let uploadedFile = null;

        // Merchant ID Validation
        function validateMerchantId() {
            const merchantId = document.getElementById('merchantId').value.trim();
            const merchantIdGroup = document.getElementById('merchantId').closest('.form-group');
            const merchantInfoCard = document.getElementById('merchantInfoCard');

            if (merchantId.length > 5) {
                // Simulate merchant lookup
                merchantIdGroup.classList.remove('error');
                merchantIdGroup.classList.add('success');

                // Show merchant info (mock data)
                merchantData = {
                    name: 'Example Securities Ltd.',
                    mcc: '6211',
                    businessType: 'Securities Broker'
                };

                document.getElementById('merchantName').textContent = merchantData.name;
                document.getElementById('businessType').textContent = merchantData.businessType;
                merchantInfoCard.classList.add('active');
            } else {
                merchantIdGroup.classList.remove('success');
                merchantInfoCard.classList.remove('active');
                merchantData = null;
            }

            validateForm();
        }

        // Bank Selection
        function selectBank(bank) {
            // Remove selected class from all
            document.querySelectorAll('.bank-option').forEach(option => {
                option.classList.remove('selected');
            });

            // Add selected class to chosen bank
            document.querySelector(`.bank-option input[value="${bank}"]`).closest('.bank-option').classList.add('selected');
            document.getElementById(`bank${bank.charAt(0).toUpperCase() + bank.slice(1)}`).checked = true;

            selectedBank = bank;
            validateForm();
        }

        // VPA Validation
        function validateVPA() {
            const vpaInput = document.getElementById('vpa');
            const vpa = vpaInput.value.trim();
            const vpaGroup = vpaInput.closest('.form-group');
            const iciciMidGroup = document.getElementById('iciciMidGroup');
            const vpaSuccess = document.getElementById('vpaSuccess');
            const vpaError = document.getElementById('vpaError');

            vpaSuccess.style.display = 'none';
            vpaError.style.display = 'none';

            if (vpa) {
                if (vpa.includes('@valid')) {
                    vpaGroup.classList.remove('error');
                    vpaGroup.classList.add('success');
                    vpaSuccess.style.display = 'block';

                    // Show ICICI MID field if needed
                    if (vpa.includes('@validicici')) {
                        iciciMidGroup.style.display = 'block';
                    } else {
                        iciciMidGroup.style.display = 'none';
                    }
                } else {
                    vpaGroup.classList.add('error');
                    vpaGroup.classList.remove('success');
                    vpaError.style.display = 'block';
                }
            } else {
                vpaGroup.classList.remove('error', 'success');
            }

            validateForm();
        }

        // IFSC Validation
        function validateIFSC() {
            const ifscInput = document.getElementById('ifsc');
            const ifsc = ifscInput.value.trim().toUpperCase();
            const ifscGroup = ifscInput.closest('.form-group');

            ifscInput.value = ifsc;

            if (ifsc && (ifsc.length !== 11 || !/^[A-Z]{4}0[A-Z0-9]{6}$/.test(ifsc))) {
                ifscGroup.classList.add('error');
            } else {
                ifscGroup.classList.remove('error');
            }

            validateForm();
        }

        // File Upload Handler
        function handleFileUpload() {
            const fileInput = document.getElementById('fileInput');
            const fileUploadArea = document.getElementById('fileUploadArea');
            const fileName = document.getElementById('fileName');

            if (fileInput.files.length > 0) {
                uploadedFile = fileInput.files[0];
                fileUploadArea.classList.add('has-file');
                fileName.textContent = `‚úì ${uploadedFile.name} (${(uploadedFile.size / 1024 / 1024).toFixed(2)} MB)`;
                fileName.style.display = 'block';
            }

            validateForm();
        }

        // Advanced Options Toggle
        function toggleAdvancedOptions() {
            const content = document.getElementById('advancedOptionsContent');
            const chevron = document.getElementById('advancedChevron');

            if (content.style.display === 'none') {
                content.style.display = 'block';
                chevron.classList.add('rotated');
            } else {
                content.style.display = 'none';
                chevron.classList.remove('rotated');
            }
        }

        // Form Validation
        function validateForm() {
            const merchantId = document.getElementById('merchantId').value.trim();
            const feature = document.getElementById('feature').value;
            const refund = document.getElementById('refund').value;
            const sebiRegistration = document.getElementById('sebiRegistration').value.trim();
            const vpa = document.getElementById('vpa').value.trim();
            const settlementAccount = document.getElementById('settlementAccount').value.trim();
            const ifsc = document.getElementById('ifsc').value.trim();
            const iciciMid = document.getElementById('iciciMid').value.trim();

            const submitBtn = document.getElementById('submitBtn');

            // All required fields check
            let isValid = merchantData !== null &&
                         feature &&
                         refund &&
                         selectedBank &&
                         sebiRegistration &&
                         vpa.includes('@valid') &&
                         settlementAccount &&
                         ifsc.length === 11 &&
                         uploadedFile;

            // Check ICICI MID if needed
            if (vpa.includes('@validicici') && !iciciMid) {
                isValid = false;
            }

            submitBtn.disabled = !isValid;
        }

        // VPA Modal Functions
        function openVpaVerificationModal() {
            document.getElementById('vpaModalOverlay').classList.add('active');
            goToVpaScreen(1);
        }

        function closeVpaModal() {
            document.getElementById('vpaModalOverlay').classList.remove('active');
        }

        function goToVpaScreen(screenNum) {
            document.querySelectorAll('#vpaModalOverlay .screen').forEach(screen => {
                screen.style.display = 'none';
            });
            document.getElementById(`vpaScreen${screenNum}`).style.display = 'block';
            document.querySelector('.modal').scrollTop = 0;
        }

        function toggleVpaCheckbox() {
            const checkbox = document.getElementById('vpaCompletionCheckbox');
            checkbox.checked = !checkbox.checked;
            updateVpaProceedButton();
        }

        function updateVpaProceedButton() {
            const checkbox = document.getElementById('vpaCompletionCheckbox');
            const proceedBtn = document.getElementById('vpaCompleteBtn');
            proceedBtn.disabled = !checkbox.checked;
        }

        function completeVpaVerification() {
            document.getElementById('vpaScreen2').style.display = 'none';
            document.getElementById('vpaSuccessScreen').style.display = 'block';

            // Update VPA status
            const vpaStatus = document.getElementById('vpaStatus');
            vpaStatus.className = 'verification-status verified';
            vpaStatus.innerHTML = '‚úì Instructions Shared with Merchant';
        }

        // Submit Request
        function submitRequest() {
            const formData = {
                merchantId: document.getElementById('merchantId').value.trim(),
                merchantName: merchantData.name,
                mcc: '6211',
                template: 'OC217',
                paymentMethod: 'upi',
                feature: document.getElementById('feature').value,
                refund: document.getElementById('refund').value,
                bank: selectedBank,
                sebiRegistration: document.getElementById('sebiRegistration').value.trim(),
                vpa: document.getElementById('vpa').value.trim(),
                settlementAccount: document.getElementById('settlementAccount').value.trim(),
                ifsc: document.getElementById('ifsc').value.trim(),
                iciciMid: document.getElementById('iciciMid').value.trim() || null,
                tags: document.getElementById('tags').value.trim(),
                specialPricing: document.getElementById('specialPricing').checked,
                directSettlement: document.getElementById('directSettlementCheckbox').checked,
                document: uploadedFile.name
            };

            console.log('Submitting OC217 Request:', formData);

            // Show success message
            alert('‚úÖ Request submitted successfully!\n\nMerchant: ' + formData.merchantName + '\nTemplate: OC217\nBank: ' + selectedBank.toUpperCase() + '\n\nThe request will be reviewed and processed within 48 hours.');

            // Reset form
            resetForm();
        }

        // Reset Form
        function resetForm() {
            document.getElementById('merchantId').value = '';
            document.getElementById('feature').value = '';
            document.getElementById('refund').value = '';
            document.getElementById('sebiRegistration').value = '';
            document.getElementById('vpa').value = '';
            document.getElementById('settlementAccount').value = '';
            document.getElementById('ifsc').value = '';
            document.getElementById('iciciMid').value = '';
            document.getElementById('tags').value = '';
            document.getElementById('specialPricing').checked = false;
            document.getElementById('directSettlementCheckbox').checked = false;
            document.getElementById('fileInput').value = '';

            merchantData = null;
            selectedBank = null;
            uploadedFile = null;

            document.getElementById('merchantInfoCard').classList.remove('active');
            document.getElementById('fileUploadArea').classList.remove('has-file');
            document.getElementById('fileName').style.display = 'none';
            document.getElementById('iciciMidGroup').style.display = 'none';

            document.querySelectorAll('.bank-option').forEach(option => {
                option.classList.remove('selected');
            });

            document.querySelectorAll('.form-group').forEach(group => {
                group.classList.remove('error', 'success');
            });

            const vpaStatus = document.getElementById('vpaStatus');
            vpaStatus.className = 'verification-status pending';
            vpaStatus.innerHTML = '‚è≥ Pending Verification';

            validateForm();
        }

        // Close modal when clicking outside
        document.getElementById('vpaModalOverlay').addEventListener('click', function(e) {
            if (e.target === this) {
                closeVpaModal();
            }
        });

        // Initial validation
        validateForm();
    </script>
</body>
</html>
